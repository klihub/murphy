-- -*- mode: lua -*-

m = murphy.get()
m:include_once('common.cfg')

load('console', {
        address = 'unxs:@murphy-slave.console'
})

load('domain-control', {
        external_address = 'unxs:@murphy-slave.domctl',
        imports = '.*_owner,.*_users',
        exports = 'test-.*'
})

load('resource-proxy', { address = "unxs:@murphy-resource-master" })

-- delay loading the resource plugins for a while

connected = m:EventListener({
    events = { "resource-library-ready" },
    callback = function (listener, id)
        print("resource library is ready")
        try_load('resource-native')

        -- load the D-Bus resource plugin if we have it and D-Bus
        try_load('resource-dbus', {
            dbus_bus = "session",
            dbus_service = "org.Murphy",
            dbus_track = true,
            default_zone = "driver",
            default_class = "player"
        })
    end })

disconnected =  m:EventListener({
    events = { "resource-library-not-ready" },
    callback = function (listener, id)
        print("resource library is not ready")
        -- TODO: unload the resource frontends
    end })



